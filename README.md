# Bulletin Board

Django веб-приложение для управления объявлениями и откликами. Система предназначена для создания, управления и взаимодействия с объявлениями в различных категориях.

## Задача проекта

Создать современное веб-приложение, которое позволяет:
- Пользователям регистрироваться и создавать профили
- Авторам публиковать объявления с форматированным текстом
- Пользователям оставлять отклики на объявления
- Авторам управлять статусами откликов (принят/в ожидании/отклонен)
- Пользователям подписываться на категории и получать уведомления
- Администраторам управлять контентом и пользователями

## Основные возможности

- **Регистрация и аутентификация** (через email и социальные сети)
- **Создание и управление объявлениями** с форматированным текстом (CKEditor)
- **Система откликов** с управлением статусами
- **Подписки на категории** с email-уведомлениями
- **Многоязычность** (английский, русский)
- **Часовые пояса** для пользователей
- **Рассылка уведомлений** (Celery + Redis)
- **REST API** для интеграции
- **Админ-панель** для управления данными
- **Кеширование** для повышения производительности

## Модели данных

### Пользователь (User)
- username (уникальный)
- email (уникальный)
- first_name, last_name
- Группы: authors, admin

### Профиль (Profile)
- Пользователь (связь 1:1)
- Пол (male/female)
- Аватар (изображение)

### Категория (Category)
- Название (из фиксированного списка: Tank, Heal, Damage dealer и т.д.)
- Подписчики (связь M:M с User)

### Объявление (Post)
- Автор (связь 1:M с Profile)
- Дата создания
- Категория (связь 1:M с Category)
- Заголовок
- Текст (RichText с CKEditor)

### Отклик (Response)
- Объявление (связь 1:M с Post)
- Дата создания
- Пользователь (связь 1:M с User)
- Текст
- Статус: accepted/in anticipation/rejected

## Технологии

- **Backend**: Django 5.2 + Django REST Framework
- **Database**: SQLite
- **Templates**: Django Templates + Bootstrap
- **Email**: SMTP (Yandex)
- **Async tasks**: Celery + Redis
- **Rich text editor**: CKEditor
- **Authentication**: Django Allauth
- **Internationalization**: Django i18n
- **Caching**: Django cache framework
- **Isolated Environment**: Docker

## Основные URL
- **Главная страница**: `http://localhost:8000/`
- **Список объявлений**: `http://localhost:8000/posts/`
- **REST API**: `http://localhost:8000/api/`
- **Админ-панель**: `http://localhost:8000/admin/`
- **Аутентификация**: `http://localhost:8000/accounts/`

## Установка

### Способ 1: Локальная установка

**1. Клонировать репозиторий**

```bash
git clone https://github.com/erdes10032/bulletin-board.git
cd bulletin-board/bulletinboard
```

**2. Создать виртуальное окружение**

```bash
python -m venv venv
source venv/bin/activate  # Linux
# или
venv\Scripts\activate  # Windows
```

**3. Установить зависимости**

```bash
pip install -r requirements.txt
```

**2. Заполнить файл .env своими данными**

**5. Выполнить миграции**

```bash
python manage.py makemigrations
python manage.py migrate
```

**6. Создать суперпользователя**

```bash
python manage.py createsuperuser
```

**7. Запустить сервер**

```bash
# Запуск Django сервера
python manage.py runserver
# В другом терминале запустить Celery worker
celery -A bulletinboard worker -l INFO
# И Celery beat для периодических задач
celery -A bulletinboard beat -l INFO
```

### Способ 2: Docker-установка

**1. Клонировать репозиторий**

```bash
git clone https://github.com/erdes10032/bulletin-board.git
cd bulletin-board/bulletinboard
```

**2. Заполнить файл .env своими данными**

**3. Запустить проект**

```bash
docker-compose up --build
```
Проект будет доступен по адресу: http://localhost:8000

**4. Остановить проект (опционально)**

```bash
docker-compose down
```

**5. Остановить проект с удалением всех данных (опционально)**

```bash
docker-compose down -v --rmi all
```

## Использование

### 1. Регистрация и вход

- Перейдите на главную страницу http://localhost:8000/
- Нажмите "Profile" в навигационной панели
- Выберите "Sign Up" для регистрации
- Заполните форму
- Подтвердите email
- После регистрации вы автоматически добавляетесь в группу "authors"

### 2. Создание объявления

**Требования: Только пользователи в группе "authors" могут создавать объявления**

- Перейдите в раздел "Posts"
- Нажмите кнопку "Make post"
- Заполните форму:
  - Выберите категорию
  - Введите заголовок (должен начинаться с заглавной буквы)
  - Введите текст с помощью CKEditor (минимум 15 симвонов)
  - Нажмите "Save"
- Перейдите на главную страницу http://localhost:8000/

**Пример успешного создания**:

- Объявление появится в общем списке
- Все подписчики категории получат email-уведомление
- Автор может редактировать и удалять своё объявление

### 3. Оставление отклика

**Требования: Зарегистрированный пользователь**

- Перейдите к конкретному объявлению
- Нажмите кнопку "Create response"
- Введите текст отклика (максимум 50 символов)
- Нажмите "Save"

**Пример успешного создания**:

- Отклик появляется со статусом "in anticipation"
- Автор объявления видит все отклики
- Автор объявления может принять или отклонить отклик

### 4. Управление откликами (для авторов)

- Перейдите в свой профиль
- Нажмите "Responses to my posts"
- Используйте фильтры для поиска
- Для каждого отклика доступны действия:
    - "Accept" - принять отклик 
    - "Reject" - отклонить отклик

### 5. Подписка на категории

- Перейдите к любому объявлению
- Рядом с категорией нажмите кнопку "Subscribe"
- Теперь вы будете получать уведомления о новых объявлениях в этой категории

**Еженедельная рассылка:**

- Каждый понедельник в 8:00
- Получаете все новые объявления за прошедшую неделю
- По всем подписанным категориям

## API Документация

**Приложение предоставляет REST API через Django REST Framework:**

### Доступные методы:


| Метод   | Эндпоинт | Описание |  Аутентификация |
|---------|----------|----------|----------|
| `GET`   | `/api/user/` | Список пользователей | Требуется |
| `POST`  | `/api/user/` | Создание пользователя | Требуется |
| `GET`   | `/api/profile/` | Список профилей | Требуется |
| `GET` | `/api/category/` | Список категорий | Не требуется |
| `GET` | `/api/post/` | Список объявлений | Не требуется |
| `POST` | `/api/post/` | Создание объявления | Требуется |
| `GET` | `/api/response/` | Список откликов | Требуется |
| `POST` | `/api/response/` | Создание отклика | Требуется |

### Пример использования API:

Получение списка объявлений:

```bash
curl -X GET "http://localhost:8000/api/post/"
```
Создание объявления (с аутентификацией):

```bash
curl -X POST "http://localhost:8000/api/post/" \
     -H "Content-Type: application/json" \
     -u "username:password" \
     -d '{
           "title": "Новое объявление",
           "text": "Текст объявления",
           "category": 1,
           "author": 1
         }'
```

## Настройка почты

**Приложение использует Yandex SMTP для отправки email:**

- Создайте пароль приложения в Yandex:
  - Перейдите в "Управление аккаунтом" → "Пароли приложений"
  - Создайте новый пароль для приложения

- Настройте переменные окружения:

    ```bash
    EMAIL_HOST_USER=ваш_логин@yandex.ru
    EMAIL_HOST_PASSWORD=сгенерированный_пароль
    ```

- Типы отправляемых писем:
  - Подтверждение регистрации
  - Уведомления о новых объявлениях в подписанных категориях
  - Уведомления о принятых откликах
  - Еженедельные подборки объявлений

## Тестирование

```bash
# Тесты основных частей
python manage.py test board.tests.test_basic

# Тесты основных сценариев использования
python manage.py test board.tests.test_critical_paths

# Тесты валидации форм
python manage.py test board.tests.test_forms   
```

## Логирование

## Настроена система логирования с выводом в консоль и файлы:

**Файлы логов:**

- general.log - общие логи приложения
- errors.log - ошибки и исключения
- security.log - события безопасности

**Уровни логирования:**

- Консоль: WARNING, ERROR (при DEBUG=True)
- Файлы: INFO, ERROR (при DEBUG=False)
- Email администраторам: критические ошибки

## Правила валидации и ограничения

### Для создания объявления

- Только пользователи в группе "authors"
- Заголовок должен начинаться с заглавной буквы
- Текст минимум 15 символов
- Заголовок не может быть идентичен тексту
- Одно объявление за раз

### Для создания отклика

- Только зарегистрированные пользователи
- Нельзя оставлять отклик на своё объявление
- Максимальная длина текста: 50 символов
- Один отклик от пользователя на объявление

### Для управления откликами

- Только автор объявления может менять статус отклика
- Администраторы могут управлять всеми откликами
- При принятии отклика пользователь получает email

## Контекстные процессоры и middleware

### Timezone Middleware

- Определяет часовой пояс пользователя из сессии
- Позволяет выбирать часовой пояс на главной странице
- Автоматически конвертирует время для отображения

### Контекстные процессоры

- timezone_context - текущее время с учётом часового пояса
- Встроенные Django: auth, messages, i18n

## Кастомные теги и фильтры

### Теги шаблонов

- {% load custom_filters %} - кастомные фильтры
- {% load custom_tags %} - кастомные теги
- {% load tz %} - работа с часовыми поясами

### Примеры фильтров

- striptags_filter - удаляет HTML теги
- truncatechars - обрезает текст
- admin - проверка на группу admin

## Безопасность

- CSRF защита включена
- X-Frame-Options: SAMEORIGIN
- Пароли хэшируются
- Сессии защищены
- Ограничение прав через группы и permissions
- Валидация загружаемых файлов (только изображения)

## Производительность

- Кеширование отдельных объявлений
- Пагинация списков (10 элементов на страницу)
- Асинхронная отправка email через Celery
- Оптимизированные запросы к БД

## Устранение неполадок

### Проблемы с email

- Проверьте переменные окружения
- Убедитесь, что пароль приложения правильный
- Проверьте настройки SMTP в Yandex

### Проблемы с Celery:

- Проверьте подключение к Redis
- Убедитесь, что Redis запущен
- Проверьте логи worker'а

### Проблемы с переводами

- Убедитесь, что файлы перевода скомпилированы
- Проверьте настройки LANGUAGE_CODE
- Перезапустите сервер после изменений переводов

